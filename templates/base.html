<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}POS LICORERA PROFESIONAL{% endblock %}</title>

  <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/LOGO.png') }}">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

  <style>
    :root {
      --bg-glacial: #F0F7FF;
      --primary-dark: #1A365D;
      --accent-blue: #63B3ED;
      --bg-card: #BEE3F8;
      --success-cyan: #00A3C4;
      --danger-red: #C53030;
      --white: #ffffff;
      --text-main: #2D3748;
    }

    html, body {
      height: 100%;
      margin: 0;
      display: flex;
      flex-direction: column;
      background: var(--bg-glacial);
      font-family: 'Inter', sans-serif;
      color: var(--text-main);
    }

    input:focus, select:focus, textarea:focus {
      border-color: var(--accent-blue) !important;
      box-shadow: 0 0 0 0.25rem rgba(99, 179, 237, 0.25) !important;
    }

    input, textarea { text-transform: uppercase; }

    .content-wrapper { flex: 1; padding-bottom: 40px; }

    .navbar-custom {
      background-color: var(--primary-dark) !important;
      padding: 0.7rem 2rem;
      border-bottom: 4px solid var(--accent-blue);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .logo-barra { height: 45px !important; transition: transform 0.2s ease; }

    .titulo-logo {
      font-weight: 800;
      color: var(--white);
      font-size: 1.1rem;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .navbar-nav .nav-link {
      color: #e0e0e0 !important;
      margin: 0 10px;
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
      transition: 0.2s;
    }

    .navbar-nav .nav-link:hover { color: var(--accent-blue) !important; }

    .main-card {
      background: var(--white);
      padding: 30px;
      border-radius: 12px;
      border: 1px solid var(--bg-card);
      box-shadow: 0 10px 30px rgba(26, 54, 93, 0.05);
    }

    footer {
      background-color: var(--primary-dark);
      color: #a0aec0;
      padding: 20px 0;
      text-align: center;
      margin-top: auto;
      font-size: 0.85rem;
      border-top: 4px solid var(--accent-blue);
    }

    .fade-in { animation: fadeIn 0.4s ease-in; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>

<body>

{% if current_user.is_authenticated %}
<nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
  <div class="container-fluid">

    <a class="navbar-brand d-flex align-items-center" href="{{ url_for('ventas.dashboard') }}">
      <img src="{{ url_for('static', filename='img/LOGO.png') }}" class="logo-barra" alt="Logo">
      <span class="titulo-logo ms-2">LICORERA SAN ROQUE</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mx-auto">
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('inventario.inventario') }}">
              <i class="fas fa-wine-bottle me-1"></i> Inventario
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('clientes.clientes') }}"><i class="fas fa-users me-1"></i> Clientes</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('ventas.ver_mesa', mesa_id=1) }}">
                <i class="fas fa-plus-circle me-1"></i> Vender
            </a>
        </li>
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
            <i class="fas fa-hand-holding-usd me-1"></i> Cr√©ditos
          </a>
          <ul class="dropdown-menu dropdown-menu-dark shadow">
            <li><a class="dropdown-item" href="{{ url_for('creditos.creditos_largo') }}">Gesti√≥n Cr√©ditos</a></li>
          </ul>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('reportes.reportes') }}"><i class="fas fa-cash-register me-1"></i> Reportes</a>
        </li>

        {% if current_user.rol.lower() == 'administrador' %}
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" style="color: var(--accent-blue) !important;">
             <i class="fas fa-user-shield me-1"></i> Panel Admin
          </a>
          <ul class="dropdown-menu dropdown-menu-dark shadow">
            <li><a class="dropdown-item" href="{{ url_for('admin.usuarios') }}">Personal</a></li>
            <li><a class="dropdown-item" href="{{ url_for('proveedores_gastos.enlista_proveedores') }}">Proveedores</a></li>
            <li><a class="dropdown-item" href="{{ url_for('proveedores_gastos.gastos') }}">Gastos</a></li>
          </ul>
        </li>
        {% endif %}
      </ul>

      <div class="d-flex align-items-center">
        <div class="text-white text-end me-3 d-none d-lg-block">
            <div class="small fw-bold">{{ current_user.nombre | upper }}</div>
            <div class="badge" style="background-color: var(--accent-blue);">{{ current_user.rol | upper }}</div>
        </div>
        <a class="btn btn-outline-danger btn-sm fw-bold" href="{{ url_for('auth.logout') }}">SALIR</a>
      </div>
    </div>
  </div>
</nav>
{% endif %}

<div class="container mt-3 fade-in">
  {% block breadcrumb %}
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{{ url_for('ventas.dashboard') }}" class="text-decoration-none" style="color: var(--accent-blue);">Inicio</a></li>
      <li class="breadcrumb-item active">{% block page %}{% endblock %}</li>
    </ol>
  </nav>
  {% endblock %}
</div>

<div class="content-wrapper container fade-in">
  <div class="main-card">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-info alert-dismissible fade show shadow-sm">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </div>
</div>

<footer>
  <div class="container">
    <div><strong>SAN ROQUE MB - SISTEMA POS</strong></div>
    <div style="opacity: 0.6; font-size: 0.75rem;">Desarrollado por: Lorena Rodriguez Ramos &copy; 2026</div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  document.addEventListener('input', function (e) {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
        e.target.value = e.target.value.toUpperCase();
    }
  });

  document.addEventListener('keydown', function(e) {
    const selectores = 'input:not([type="hidden"]):not([disabled]), select:not([disabled]), button:not([disabled]), textarea:not([disabled])';
    if (e.key === 'Enter') {
        if (e.target.type !== 'submit' && e.target.tagName !== 'BUTTON') {
            const inputs = Array.from(document.querySelectorAll(selectores));
            const index = inputs.indexOf(e.target);
            if (index > -1 && index < inputs.length - 1) {
                e.preventDefault();
                inputs[index + 1].focus();
            }
        }
    }
  });
</script>

{% block scripts %}{% endblock %}

<!-- ================= CALCULADORA FLOTANTE PRO ================= -->

<style>
#calc-bubble{
position: fixed;
bottom: 90px; /* M√ÅS ARRIBA */
right: 25px;
width: 65px;
height: 65px;
background: linear-gradient(135deg, var(--primary-dark), var(--accent-blue));
color: white;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-size: 24px;
cursor: pointer;
box-shadow: 0 0 20px rgba(99,179,237,0.7);
transition: 0.2s ease;
z-index: 9999;
}

#calc-bubble:hover{
transform: scale(1.1);
box-shadow: 0 0 30px rgba(99,179,237,1);
}

#calc-modal{
display: none;
position: fixed;
bottom: 170px;
right: 25px;
width: 260px;
background: white;
border-radius: 16px;
box-shadow: 0 20px 40px rgba(0,0,0,0.25);
padding: 20px;
z-index: 9999;
border: 1px solid var(--bg-card);
}

#calc-display{
width: 100%;
height: 55px;
margin-bottom: 15px;
text-align: right;
font-size: 24px;
border-radius: 10px;
border: 1px solid var(--bg-card);
padding: 10px;
background: var(--bg-glacial);
font-weight: 600;
}

.calc-grid{
display: grid;
grid-template-columns: repeat(4, 1fr);
gap: 10px;
}

.calc-btn{
height: 45px;
border-radius: 10px;
font-weight: 600;
border: none;
background: #f1f5f9;
transition: 0.15s;
}

.calc-btn:hover{
background: #e2e8f0;
}

.calc-op{
background: var(--accent-blue);
color: white;
}

.calc-op:hover{
background: var(--primary-dark);
}

.calc-equal{
grid-column: span 4;
background: #198754;
color: white;
height: 50px;
}

.calc-equal:hover{
background: #146c43;
}
</style>

<div id="calc-bubble">
<i class="fas fa-calculator"></i>
</div>

<div id="calc-modal">
<input type="text" id="calc-display" readonly>

<div class="calc-grid">
<button class="calc-btn" onclick="calcPress('7')">7</button>
<button class="calc-btn" onclick="calcPress('8')">8</button>
<button class="calc-btn" onclick="calcPress('9')">9</button>
<button class="calc-btn calc-op" onclick="calcPress('/')">√∑</button>

<button class="calc-btn" onclick="calcPress('4')">4</button>
<button class="calc-btn" onclick="calcPress('5')">5</button>
<button class="calc-btn" onclick="calcPress('6')">6</button>
<button class="calc-btn calc-op" onclick="calcPress('*')">√ó</button>

<button class="calc-btn" onclick="calcPress('1')">1</button>
<button class="calc-btn" onclick="calcPress('2')">2</button>
<button class="calc-btn" onclick="calcPress('3')">3</button>
<button class="calc-btn calc-op" onclick="calcPress('-')">‚àí</button>

<button class="calc-btn" onclick="calcPress('0')">0</button>
<button class="calc-btn" onclick="calcPress('.')">.</button>
<button class="calc-btn" onclick="calcClear()">C</button>
<button class="calc-btn calc-op" onclick="calcPress('+')">+</button>

<button class="calc-btn calc-equal" onclick="calcEqual()">=</button>
</div>
</div>

<script>
let calcDisplay = document.getElementById("calc-display");
let calcModal = document.getElementById("calc-modal");
let calcBubble = document.getElementById("calc-bubble");

// Abrir / cerrar
calcBubble.addEventListener("click", function(){
calcModal.style.display = calcModal.style.display === "block" ? "none" : "block";
if(calcModal.style.display === "block"){
    calcDisplay.focus();
}
});

// Cerrar si hacen click fuera
document.addEventListener("click", function(e){
if(!calcModal.contains(e.target) && !calcBubble.contains(e.target)){
calcModal.style.display = "none";
}
});

// BOTONES
function calcPress(value){
calcDisplay.value += value;
}

function calcClear(){
calcDisplay.value = "";
}

function calcEqual(){
try{
calcDisplay.value = Function('"use strict";return (' + calcDisplay.value + ')')();
}catch{
calcDisplay.value = "Error";
}
}

// =========================
// SOPORTE TECLADO üî•
// =========================
document.addEventListener("keydown", function(e){

// Solo si est√° abierta
if(calcModal.style.display !== "block") return;

// N√∫meros
if(!isNaN(e.key)){
calcDisplay.value += e.key;
}

// Operadores
if(["+", "-", "*", "/"].includes(e.key)){
calcDisplay.value += e.key;
}

// Punto decimal
if(e.key === "."){
calcDisplay.value += ".";
}

// Enter = calcular
if(e.key === "Enter"){
e.preventDefault();
calcEqual();
}

// Backspace = borrar √∫ltimo
if(e.key === "Backspace"){
calcDisplay.value = calcDisplay.value.slice(0, -1);
}

// Escape = cerrar
if(e.key === "Escape"){
calcModal.style.display = "none";
}

});
</script>


<!-- ================= FIN CALCULADORA ================= -->


</body>
</html>