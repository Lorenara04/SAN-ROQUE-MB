<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}POS LICORERA PROFESIONAL{% endblock %}</title>

  <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/LOGO.png') }}">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

  <style>
    :root {
      --azul-primario: #0288d1;
      --azul-hover: #03a9f4;
      --negro-premium: #111111;
      --texto-oscuro: #2c3e50;
      --fondo-gris: #f4f7f9;
      --blanco: #ffffff;
      --danger-red: #ff4d4d;
    }

    html, body {
      height: 100%;
      margin: 0;
      display: flex;
      flex-direction: column;
      background: var(--fondo-gris);
      font-family: 'Inter', sans-serif;
      color: var(--texto-oscuro);
    }

    /* MEJORA: Todo lo que escriba se verá en MAYÚSCULAS visualmente */
    input, textarea {
      text-transform: uppercase;
    }

    .content-wrapper {
      flex: 1;
      padding-bottom: 40px;
    }

    .navbar-custom {
      background-color: var(--negro-premium);
      padding: 0.7rem 2rem;
      border-bottom: 4px solid var(--azul-primario);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    .logo-barra {
      height: 45px !important;
      transition: transform 0.2s ease;
    }

    .titulo-logo {
      font-weight: 800;
      color: white;
      font-size: 1.1rem;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .navbar-nav .nav-link {
      color: #e0e0e0 !important;
      margin: 0 10px;
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
      transition: 0.2s;
      position: relative;
    }

    .navbar-nav .nav-link:hover {
      color: var(--azul-primario) !important;
    }

    .notif-badge {
      position: absolute;
      top: 0;
      right: -5px;
      width: 8px;
      height: 8px;
      background-color: var(--danger-red);
      border-radius: 50%;
      display: none;
      box-shadow: 0 0 5px var(--danger-red);
    }

    .dropdown-menu-dark {
      background-color: #1a1a1a;
      border: 1px solid #333;
    }

    .main-card {
      background: var(--blanco);
      padding: 30px;
      border-radius: 12px;
      border: 1px solid #e1e8ed;
      box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    }

    footer {
      background-color: var(--negro-premium);
      color: #999;
      padding: 20px 0;
      text-align: center;
      margin-top: auto;
      font-size: 0.85rem;
      border-top: 4px solid var(--azul-primario);
    }

    footer strong { color: var(--blanco); }

    .fade-in {
      animation: fadeIn 0.4s ease-in;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>

<body>

{% if current_user.is_authenticated %}
<nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
  <div class="container-fluid">

    <a class="navbar-brand d-flex align-items-center" href="{{ url_for('ventas.dashboard') }}">
      <img src="{{ url_for('static', filename='img/LOGO.png') }}" class="logo-barra" alt="Logo">
      <span class="titulo-logo ms-2 text-white">LICORERA SAN ROQUE</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mx-auto">
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('inventario.inventario') }}" id="nav-inventario">
              <i class="fas fa-wine-bottle me-1"></i> Inventario
              <span class="notif-badge" id="alerta-punto"></span>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('clientes.clientes') }}"><i class="fas fa-users me-1"></i> Clientes</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('ventas.nueva_venta') }}"><i class="fas fa-plus-circle me-1"></i> Vender</a>
        </li>
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
            <i class="fas fa-hand-holding-usd me-1"></i> Créditos
          </a>
          <ul class="dropdown-menu dropdown-menu-dark shadow">
            <li><a class="dropdown-item" href="{{ url_for('creditos.creditos_corto') }}"><i class="fas fa-bolt me-2 text-warning"></i>Corto Plazo</a></li>
            <li><a class="dropdown-item" href="{{ url_for('creditos.creditos_largo') }}"><i class="fas fa-calendar-alt me-2 text-info"></i>Largo Plazo (15 días)</a></li>
          </ul>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="{{ url_for('reportes.reportes') }}"><i class="fas fa-cash-register me-1"></i> Reportes / Caja </a>
        </li>

        {% if current_user.rol.lower() == 'administrador' %}
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle text-info" href="#" data-bs-toggle="dropdown">Panel Admin</a>
          <ul class="dropdown-menu dropdown-menu-dark shadow">
            <li><a class="dropdown-item" href="{{ url_for('ventas.gestion_ventas') }}">Gestión Ventas</a></li>
            <li><a class="dropdown-item" href="{{ url_for('admin.usuarios') }}">Personal</a></li>
            <li><a class="dropdown-item" href="{{ url_for('proveedores_gastos.enlista_proveedores') }}">Proveedores/Gastos</a></li>
          </ul>
        </li>
        {% endif %}
      </ul>

      <div class="d-flex align-items-center">
        <div class="text-white text-end me-3 d-none d-lg-block">
            <div class="small fw-bold">{{ current_user.nombre | upper }}</div>
            <div class="badge bg-primary" style="font-size: 0.6rem;">{{ current_user.rol }}</div>
        </div>
        <a class="btn btn-outline-danger btn-sm fw-bold" href="{{ url_for('auth.logout') }}">
            <i class="fas fa-power-off"></i> SALIR
        </a>
      </div>
    </div>
  </div>
</nav>
{% endif %}

<div class="container mt-3 fade-in">
  {% block breadcrumb %}
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{{ url_for('ventas.dashboard') }}" class="text-decoration-none">Inicio</a></li>
      <li class="breadcrumb-item active" aria-current="page">{% block page %}{% endblock %}</li>
    </ol>
  </nav>
  {% endblock %}
</div>

<div class="content-wrapper container fade-in">
  <div class="main-card">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category if category != 'message' else 'info' }} alert-dismissible fade show shadow-sm">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </div>
</div>

<footer>
  <div class="container">
    <div class="mb-1"><strong>POS LICORERA PROFESIONAL</strong></div>
    <div style="opacity: 0.6; font-size: 0.75rem;">
        Desarrollado por: Lorena Rodriguez Ramos &copy; 2026
    </div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // 1. Notificaciones (Original)
  function mostrarPuntoNotificacion() {
    const punto = document.getElementById('alerta-punto');
    if (punto) punto.style.display = 'block';
  }

  // 2. MAYÚSCULAS AUTOMÁTICAS (Valor real del dato)
  document.addEventListener('input', function (e) {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
        e.target.value = e.target.value.toUpperCase();
    }
  });

  // 3. NAVEGACIÓN GLOBAL CON TECLADO
  document.addEventListener('keydown', function(e) {
    const selectores = 'input:not([type="hidden"]):not([disabled]), select:not([disabled]), button:not([disabled]), textarea:not([disabled])';
    
    // ENTER funciona como TABULADOR
    if (e.key === 'Enter') {
        // No aplicamos si el usuario ya está en un botón o es un submit
        if (e.target.type !== 'submit' && e.target.tagName !== 'BUTTON') {
            const inputs = Array.from(document.querySelectorAll(selectores));
            const index = inputs.indexOf(e.target);
            if (index > -1 && index < inputs.length - 1) {
                e.preventDefault();
                inputs[index + 1].focus();
            }
        }
    }

    // FLECHAS para moverse entre campos
    if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
        const inputs = Array.from(document.querySelectorAll(selectores));
        const index = inputs.indexOf(e.target);
        if (index > -1) {
            if (e.key === 'ArrowDown' && index < inputs.length - 1) {
                e.preventDefault();
                inputs[index + 1].focus();
            } else if (e.key === 'ArrowUp' && index > 0) {
                e.preventDefault();
                inputs[index - 1].focus();
            }
        }
    }
  });

  // 4. FOCO AUTOMÁTICO AL CARGAR
  window.addEventListener('DOMContentLoaded', (event) => {
    const primerInput = document.querySelector('input:not([type="hidden"]):not([disabled])');
    if (primerInput) {
        primerInput.focus();
    }
  });
</script>

{% block scripts %}{% endblock %}
</body>
</html>