{% extends "base.html" %}
{% block title %}Clientes - SAN ROQUE MB{% endblock %}

{% block content %}
<style>
    :root {
        --azul-bebe: #e0f2fe;
        --azul-pastel: #bae6fd;
        --azul-primario: #7dd3fc;
        --azul-oscuro: #0369a1;
        --blanco-puro: #ffffff;
        --success-pastel: #dcfce7;
        --danger-pastel: #fee2e2;
        --text-main: #1e293b;
    }

    body { background-color: #f8fafc; color: var(--text-main); }

    .header-seccion {
        background: linear-gradient(135deg, var(--azul-pastel), var(--azul-bebe));
        color: var(--azul-oscuro); padding: 30px; border-radius: 25px; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px; 
        border: 1px solid var(--azul-primario);
    }

    .tabla-container {
        background: var(--blanco-puro); border-radius: 25px; overflow: hidden; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.02); border: 1px solid var(--azul-pastel);
    }

    .table thead th {
        background: var(--azul-bebe) !important; color: var(--azul-oscuro) !important;
        text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1px; 
        padding: 20px; border: none;
    }

    .table tbody td { padding: 18px 20px; vertical-align: middle !important; border-color: transparent; }

    /* --- EFECTO CEBRADO (Zebra Striping) --- */
    .table-cebrado tbody tr:nth-child(even) {
        background-color: rgba(224, 242, 254, 0.3); /* Un toque muy suave de azul-bebe */
    }
    .table-cebrado tbody tr:hover {
        background-color: var(--azul-pastel) !important;
        transition: 0.3s;
    }

    /* --- AJUSTE DE CATEGORÍA (BADGES) --- */
    .badge-tipo { 
        display: inline-flex; 
        align-items: center; 
        justify-content: center; 
        gap: 6px; 
        padding: 6px 12px; 
        border-radius: 10px; 
        font-weight: 700; 
        font-size: 11px; 
        text-transform: uppercase;
        white-space: nowrap; /* EVITA QUE EL TEXTO SE BAJE */
        min-width: 110px;    /* Ancho consistente */
    }
    
    .badge-premium { background: #fef3c7; color: #92400e; border: 1px solid #fde68a; }
    .badge-estandar { background: var(--azul-bebe); color: var(--azul-oscuro); border: 1px solid var(--azul-primario); }

    /* Botones de Acción */
    .btn-nuevo {
        background: var(--azul-oscuro); color: white; border-radius: 15px;
        font-weight: 600; padding: 12px 25px; transition: 0.3s; border: none;
    }
    .btn-nuevo:hover { background: var(--text-main); transform: translateY(-2px); color: white; }

    .btn-accion {
        width: 35px; height: 35px; border-radius: 10px; display: inline-flex;
        align-items: center; justify-content: center; border: none; transition: 0.2s;
    }
    .btn-edit { background: var(--azul-bebe); color: var(--azul-oscuro); }
    .btn-delete { background: var(--danger-pastel); color: #b91c1c; }

    /* Modales */
    .modal-content { border-radius: 30px; border: none; }
    .modal-header { background: var(--azul-oscuro); color: white; padding: 20px 30px; border-radius: 30px 30px 0 0; }
</style>

<div class="container py-4">
    <div class="header-seccion d-flex justify-content-between align-items-center">
        <div>
            <h1 class="mb-1 fw-bold"><i class="fas fa-users me-2"></i> Gestión de Clientes</h1>
            <p class="mb-0 opacity-75">San Roque M.B - Base de Datos de Fidelización</p>
        </div>
        <button class="btn btn-nuevo shadow-sm" data-bs-toggle="modal" data-bs-target="#agregarClienteModal">
            <i class="fas fa-plus-circle me-1"></i> NUEVO CLIENTE
        </button>
    </div>

    <div class="tabla-container">
        <table class="table table-cebrado mb-0">
            <thead>
                <tr>
                    <th>Nombre / Razón Social</th>
                    <th class="text-center">Tipo</th>
                    <th>Contacto</th>
                    <th>Email</th>
                    <th>Dirección</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for cliente in clientes %}
                <tr>
                    <td>
                        <div class="fw-bold text-dark">{{ cliente.nombre | upper }}</div>
                        <small class="text-muted">ID: #{{ cliente.id }}</small>
                    </td>
                    <td class="text-center">
                        {% if cliente.tipo == 'premium' %}
                            <span class="badge-tipo badge-premium"><i class="fas fa-crown"></i> PREMIUM</span>
                        {% else %}
                            <span class="badge-tipo badge-estandar">ESTÁNDAR</span>
                        {% endif %}
                    </td>
                    <td><i class="fas fa-phone-alt me-2 text-muted small"></i>{{ cliente.telefono or 'N/A' }}</td>
                    <td class="small">{{ cliente.email or 'N/A' }}</td>
                    <td class="small">{{ cliente.direccion or 'N/A' }}</td>
                    <td class="text-center">
                        <div class="d-flex gap-2 justify-content-center">
                            <button class="btn-accion btn-edit" title="Editar"
                                onclick="prepararEdicion('{{ cliente.id }}', '{{ cliente.nombre|e }}', '{{ cliente.telefono|e }}', '{{ cliente.email|e }}', '{{ cliente.direccion|e }}', '{{ cliente.tipo }}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <form action="{{ url_for('clientes.eliminar_cliente', id=cliente.id) }}" method="POST" class="d-inline">
                                <button class="btn-accion btn-delete" onclick="return confirm('¿Eliminar cliente?')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="agregarClienteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow-lg">
            <form method="POST" action="{{ url_for('clientes.agregar_cliente') }}">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">Agregar Cliente</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <input type="text" name="nombre" class="form-control mb-3" placeholder="Nombre" required>
                    <select name="tipo" class="form-select mb-3">
                        <option value="estandar">Estándar</option>
                        <option value="premium">Premium</option>
                    </select>
                    <input type="text" name="telefono" class="form-control mb-3" placeholder="Teléfono">
                    <input type="email" name="email" class="form-control mb-3" placeholder="Email">
                    <input type="text" name="direccion" class="form-control mb-3" placeholder="Dirección">
                </div>
                <div class="modal-footer border-0">
                    <button type="submit" class="btn btn-nuevo w-100">GUARDAR CLIENTE</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editarClienteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow-lg">
            <form method="POST" id="formEditarCliente">
                <div class="modal-header" style="background: var(--text-main);">
                    <h5 class="modal-title fw-bold">Editar Cliente</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <input type="text" name="nombre" id="edit_nombre" class="form-control mb-3" required>
                    <select name="tipo" id="edit_tipo" class="form-select mb-3">
                        <option value="estandar">Estándar</option>
                        <option value="premium">Premium</option>
                    </select>
                    <input type="text" name="telefono" id="edit_telefono" class="form-control mb-3">
                    <input type="email" name="email" id="edit_email" class="form-control mb-3">
                    <input type="text" name="direccion" id="edit_direccion" class="form-control mb-3">
                </div>
                <div class="modal-footer border-0">
                    <button type="submit" class="btn btn-nuevo w-100">ACTUALIZAR DATOS</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function prepararEdicion(id, nombre, telefono, email, direccion, tipo) {
    document.getElementById('edit_nombre').value = nombre;
    document.getElementById('edit_telefono').value = telefono || '';
    document.getElementById('edit_email').value = email || '';
    document.getElementById('edit_direccion').value = direccion || '';
    document.getElementById('edit_tipo').value = tipo || 'estandar';
    document.getElementById('formEditarCliente').action = "{{ url_for('clientes.editar_cliente', id=0) }}".replace('0', id);
    new bootstrap.Modal(document.getElementById('editarClienteModal')).show();
}
</script>
{% endblock %}